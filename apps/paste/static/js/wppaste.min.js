var wppaste={build_lang_menu:function(){var a=wp_modelist.modes;a.sort(function(a,c){return a.caption<c.caption?-1:a.caption>c.caption?1:0});var b=document.createDocumentFragment(),d=document.createElement("option");$(d).attr({val:""});$(d).text("[none]");$(b).append(d);for(var c,e=0;e<a.length;e++)d=a[e],c=document.createElement("option"),$(c).attr({val:d.mode}),$(c).text(d.caption),$(b).append(c);$("#langselect").append(b)},build_theme_menu:function(){var a=wp_themelist.themes;a.sort(function(a,
c){return a.caption<c.caption?-1:a.caption>c.caption?1:0});for(var b=document.createDocumentFragment(),d,c,e=0;e<a.length;e++)d=wp_themelist.themes[e],c=document.createElement("option"),$(c).attr({val:d.theme}),$(c).text(d.caption),$(b).append(c);$("#themeselect").append(b)},get_paste_author:function(){return $("#paste-author-entry").val()},get_paste_title:function(){return $("#paste-title-entry").val()},get_selected_lang:function(){var a=document.getElementById("langselect");return $(a.options[a.selectedIndex]).text()},
get_selected_mode:function(){var a=document.getElementById("langselect");return $(a.options[a.selectedIndex]).attr("val")},get_selected_theme:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).attr("val")},get_selected_theme_name:function(){var a=document.getElementById("themeselect");return $(a.options[a.selectedIndex]).text()},load_paste_settings:function(a){var b=$.cookie("pastesettings"),d="",c="Python",e="Solarized Dark";a=a||{nolangset:!1};b&&(b=JSON.parse(b),
d=b.author||"",c=b.lang||"Python",e=b.theme||"Solarized Dark");a.nolangset||wppaste.set_selected_mode(c);wppaste.set_selected_theme(e);$("#paste-author-entry").val(d)},on_mode_change:function(){var a=wppaste.get_selected_mode();wp_content.getSession().setMode(a)},on_theme_change:function(){var a=wppaste.get_selected_theme();wp_content.setTheme(a)},save_paste_settings:function(){var a=JSON.stringify({lang:wppaste.get_selected_lang(),author:wppaste.get_paste_author(),theme:wppaste.get_selected_theme_name()});
$.cookie("pastesettings",a,{expires:365,path:"/"})},set_selected_mode:function(a){for(var b=document.getElementById("langselect"),d=b.options.length,c=0;c<d;c++)if(a==$(b.options[c]).text())return b.selectedIndex=c,wppaste.on_mode_change(),!0;console.log('No mode named: "'+a+'"');b.selectedIndex=0;wppaste.on_mode_change();return!1},set_selected_theme:function(a){for(var b=document.getElementById("themeselect"),d=b.options.length,c=0;c<d;c++)if(a==$(b.options[c]).text())return b.selectedIndex=c,wppaste.on_theme_change(),
!0;console.log('No theme named: "'+a+'"');b.selectedIndex=0;wppaste.on_theme_change();return!1},submit_paste:function(a){a=a?a:{};a.author=wppaste.get_paste_author();a.content=wp_content.getValue();a.title=wppaste.get_paste_title();a.language=wppaste.get_selected_lang();var b=$("#replyto-id").attr("value");a.replyto=b;if(wptools.is_emptystr(a.content))return show_error_msg('<span class="warning-msg">Paste must have some content.</span>'),!1;a.title||(a.title="Untitled");update_loading_msg("<span>Submitting paste...</span>");
$.ajax({type:"post",contentType:"application/json",url:"/apps/paste/submit",data:JSON.stringify(a),dataType:"json",failure:function(a,c,b){console.log("failure: "+c)},complete:function(a,c){if("error"==c)console.log("wp-error response: "+a.responseText);else{var b=JSON.parse(a.responseText);b.status&&"error"===b.status?(show_error_msg('<span class="warning-msg">'+b.message+"</span>"),console.log("error: "+b.message)):(wppaste.submit_success(b),$("#floater").fadeOut())}},status:{404:function(){console.log("PAGE NOT FOUND!")},
500:function(){console.log("A major error occurred.")}}})},submit_success:function(a){a.url&&(wppaste.save_paste_settings(),wptools.navigateto(a.url))}};
function setup_ace(a){wp_content=ace.edit("paste-content");wp_content.setHighlightActiveLine(!0);wp_content.setAnimatedScroll(!0);wp_content.setFontSize(14);wp_content.getSession().setUseSoftTabs(!0);a&&wp_content.setReadOnly(!0);wp_modelist=ace.require("ace/ext/modelist");wppaste.build_lang_menu();wp_themelist=ace.require("ace/ext/themelist");wppaste.build_theme_menu()}
function update_loading_msg(a){$("#floater-msg").html(a);wptools.center_element("#floater");$("#floater");$(this).scrollTop();$("#floater").fadeIn()}function show_error_msg(a){$("#floater-msg").html(a);wptools.center_element("#floater");$("#floater");$(this).scrollTop();$("#floater").fadeIn();setTimeout(function(){kill_message()},3E3)}function kill_message(){$("#floater").fadeOut()};
