<div class='wp-block feature-list' style='padding-top: 20px;'>
    <!-- Description -->
    Python evaluation bot for IRC. PyVal was made to evaluate python code
    safely (without compromising your own system), and depends on 
    [l]pypy-sandbox | http://pypy.org[?l]
    to block certain system calls. 
    <br><br>
    Within the PyVal directory, there is also a handy little tool called 
    'PyValExec', which is used by 'PyValBot', but can be used as a standalone 
    sandbox for testing purposes.
    <br>
    <br>
    The sandbox uses a 'fake' file system, that contains two directories:
    [bash]/bin[?bash] and [bash]/tmp[?bash]
    <br><br>
    The [bash]/tmp[?bash] directory contains a helper script called 
    [bash]pyval_sandbox.py[/bash] which by itself does not offer any security.
    It's main job is to take python code from [bash]stdin[/bash], and compile/run it.
    The security comes from running this 'helper script' inside the sandbox.
    <br><br>
    The [bash]/bin[?bash] directory contains several libraries/modules needed to
    run [l]pypy-sandbox | http://pypy.org[?l]
    <br><br>
    Read access is allowed in these two directories, but any [python]write()[/python]
    calls are automatically blocked. The sandbox allows you to [python]import[/python]
    many python modules, but will fail for certain 'critical' modules that are known
    to be insecure for sandbox purposes.
</div>

<!-- Article Ad -->
{{ article_ad }}

<div class='wp-block feature-list'>
    <!-- Requirements -->
    <div class='title-box'>
        <h3 class='title'>Requirements</h3>
    </div>
    <ul class='circle blue'>
        <li class='B'>
            python-pypy.sandbox or python-pypy.translator.sandbox package
        </li>
        <div class='listdesc'>
            Found in debian/ubuntu distros.<br>
            This package provides the prebuilt pypy-sandbox executable which is used 
            by <strong>PyVal</strong> to run code safely.<br>
            <strong>PyVal</strong> looks for [bash]/usr/bin/pypy-sandbox[?bash].
        </div>
        <li class='B'>
            pastebinit package
        </li>
        <div class='listdesc'>
            Command-line utility to pastebin content when the output limit for chat is exceeded.
            <br>
            As of right now, http://paste.pound-python.org is used.<br>
            <strong>PyVal</strong> looks for [bash]/usr/bin/pastebinit[?bash].
        </div>
        <li class='B'>
            Twisted python module
        </li>
        <div class='listdesc'>
            The bot uses [python]twisted.internet[/python].
        </div>
        <li class='B'>
            <a class='B' href='http://python.org' target='_blank'>Python 2.7</a>
        </li>
        <div class='listdesc'>
            When [l]Twisted | http://twistedmatrix.com[?l] fully supports
            [l]Python 3 | http://python.org/download/releases/[?l], this project
            may be ported over.
        </div>

    </ul>
</div>

<!-- Download -->
<div class='wp-block feature-list'>
    <div class='title-box'>
        <h3 class='title'>Download</h3>
    </div>
    {{ download_code }}
</div>

<!-- Source -->
<div class='wp-block feature-list' id='source'>
    <div class='title-box'>
        <h3 class='title'>Source Code</h3>
    </div>
    <p>
        <a href='https://github.com/welbornprod/pyvalbot/tree/dev' target='_blank'>
            PyVal (github)
        </a>
        &nbsp;- current <strong>PyVal</strong> source code at 
        <a href='http://github.com' target="_blank">github</a>.
    </p>
    {{ source_view }}
</div>

<div class='wp-block feature-list'>
    <!-- Notes -->
    <div class='title-box'>
        <h3 class='title'>Notes</h3>
    </div>
    <div>
        The bot connects to [python]irc.freenode.net[/python].
        <br><br>
        Joins [bash]#pyval[/bash] on successful connection.
        <br>
        You can set the auto-join channels with the [bash]--channels[/bash] command-line option.
        <br><br>
        Nickname is set to <span class='I'>pyval</span>,
        which is registered to me so you will want to change that.
        <br>
        You can set the nick with the [bash]--nick[/bash] command-line option.
        <br><br>
        You are certainly free to take this code and start your own eval bot. 
        If you change the source in any way, please change the name from 
        <strong>PyVal</strong> / <strong>PyValBot</strong> to something else.
        <br><br>
        If you want to contribute to the original <strong>PyVal</strong>, 
        you can clone this project on 
        <a href='https://github.com/welbornprod/pyvalbot/tree/dev' target='_blank'>
            github.com
        </a> and send pull requests.
    </div>
</div>

<div class='wp-block feature-list'>
    <!-- Bot Usage -->
    <div class='title-box'>
        <h3 class='title'>PyValBot Usage:</h3>
    </div>
    <div>
        To run the full pyval irc bot:
        <br>
        <code>./pyvalbot.py --nick MyBot --channels #mychan1,#mychan2</code>
        <br>
        ...you can also use the [bash]pyval[/bash] symlink.
        <br><br>
        To view all options run this:
        <br>
        <code>./pyval --help</code>
    </div>
</div>

<div class='wp-block feature-list'>
    <!-- PyValExec Usage -->
    <div class='title-box'>
        <h3 class='title'>PyValExec Usage:</h3>
    </div>
    <div>
        The pyval-exec module can be executed by itself from the command line.
        <br><br>
        To test the functionality of the sandbox without connecting to irc:
        <br>
        <div class='codewrap'>
            $ ./pyval_exec.py "s = 'test\\\\n';print(s * 3)"<br>
            Content: s = 'test\\n';print(s * 3)<br>
            <br>
            Results (safe_output()):<br>
            test\ntest\ntest<br>
        </div>
        <br><br>
        Notice the [python]safe_output()[/python]. Newlines are replaced with the 
        escaped [python]\\n[/python], and long output is truncated.
        <br><br>
        Also, when the input is a string (as opposed to a file name),
        special handling is needed to use the [python]\n[/python] character.<br>
        PyValExec reads [python]\\n[/python] as a literal newline ([python]\n[/python], 
        as if you pressed Enter.)<br>
        To use the escaped newline, you actually have to double-escape it with [py]\\n[/py].
        <br><br>
        When sending input to the bot, you would type them exactly as above.
        <br>
        However, when running from the shell, the shell also needs escaping.
        <br>
        This is why the above code uses [py]\\\\n[/py],
        so PyValExec actually receives [py]\\n[/py],
        which is then converted to an actual [py]\n[/py].
        <br><br>
        If you want full output, run it with the [bash]-r[/bash] or [bash]--raw[/bash] flag.
        <br><br>
        PyValExec also has a symlink, you can use [bash]pyvalexec[/bash], like this:
        <br>
        <div class='codewrap'>
            $ ./pyvalexec "for i in range(3):\\n    print(str(i))" -r<br>
            Content: for i in range(3):\n    print(str(i))<br>
            <br>
            Results (raw output):<br>
            0<br>
            1<br>
            2<br>
        </div>
        <br><br>
        Notice the [python]\\n[/python] which was escaped in the shell to send the two characters
        [python]\[/python] and [python]n[/python] (an escaped newline in python).<br>
        PyValExec reads this as an actual newline, and interprets the code as if you
        had pressed Enter, and then indented four spaces.
        <br><br>
        PyValExec will also read code from a file and run it. However, the
        [python]__name__[/python] is not set to [python]'__main__'[/python],<br>
        it is instead set to [py]'__pyval__'[/py].<br>
        This allows you to block scripts from running outside of the sandbox.<br><br>
        So you can do things like this:<br>
        <pre class='python'>
import sys
if __name__ == '__main__':
    print('Script cannot be ran outside of the PyValExec sandbox!')
    sys.exit(1)
elif __name__ == '__pyval__':
    print('We are running inside of the sandbox.')
else:
    print('This script is not meant to be imported!')
    sys.exit(1)
        </pre>
        I suggest writing code especially for the sandbox, instead of sending your
        scripts as-is to the sandbox.
        <br><br>
        To run code from a file just pass the file name to PyValExec:
        <br>
        <code>
            $ ./pyvalexec myscript.py
        </code>
    </div>
</div>
